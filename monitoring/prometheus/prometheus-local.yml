# Prometheus Configuration for Local Docker Development
# Simplified configuration for docker-compose monitoring stack

global:
  scrape_interval: 15s
  scrape_timeout: 10s
  evaluation_interval: 15s
  external_labels:
    cluster: 'freightliner-local'
    environment: 'development'
    service: 'container-replication'

# Alertmanager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - alertmanager:9093
      timeout: 10s
      api_version: v2

# Load alert rules
rule_files:
  - '/etc/prometheus/rules/*.yml'

# Scrape configurations for local Docker services
scrape_configs:
  # Freightliner application metrics
  - job_name: 'freightliner'
    honor_labels: true
    static_configs:
      - targets:
          - 'freightliner-api:2112'
        labels:
          app: 'freightliner'
          tier: 'application'
          instance: 'local'
    metric_relabel_configs:
      # Keep only freightliner metrics
      - source_labels: [__name__]
        regex: 'freightliner_.*|go_.*|process_.*'
        action: keep

  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets:
          - 'localhost:9090'
        labels:
          app: 'prometheus'
          tier: 'monitoring'

  # Node exporter for system metrics (optional - full profile)
  - job_name: 'node-exporter'
    static_configs:
      - targets:
          - 'node-exporter:9100'
        labels:
          app: 'node-exporter'
          tier: 'system'

  # cAdvisor for container metrics (optional - full profile)
  - job_name: 'cadvisor'
    static_configs:
      - targets:
          - 'cadvisor:8080'
        labels:
          app: 'cadvisor'
          tier: 'container'
    metric_relabel_configs:
      # Keep only container metrics for freightliner services
      - source_labels: [container_label_com_docker_compose_project]
        regex: 'freightliner.*'
        action: keep

  # Redis exporter (if Redis has metrics endpoint)
  - job_name: 'redis'
    static_configs:
      - targets:
          - 'redis:6379'
        labels:
          app: 'redis'
          tier: 'cache'
    # Redis doesn't expose Prometheus metrics by default
    # You need redis_exporter sidecar for this
    # metric_path: '/metrics'

  # AlertManager self-monitoring
  - job_name: 'alertmanager'
    static_configs:
      - targets:
          - 'alertmanager:9093'
        labels:
          app: 'alertmanager'
          tier: 'monitoring'

  # Docker daemon metrics (requires Docker to expose metrics)
  # Uncomment if you've configured Docker to expose Prometheus metrics
  # - job_name: 'docker'
  #   static_configs:
  #     - targets:
  #         - 'host.docker.internal:9323'
  #       labels:
  #         app: 'docker'
  #         tier: 'platform'

# Storage configuration
storage:
  tsdb:
    # Optimize for local development
    out_of_order_time_window: 30m

# Remote write/read disabled for local development
# Uncomment for long-term storage integration
# remote_write:
#   - url: "http://remote-storage:9009/api/v1/write"
# remote_read:
#   - url: "http://remote-storage:9009/api/v1/read"
